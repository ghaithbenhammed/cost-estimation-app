<div *ngIf="loading" class="loading-zone">â³ Chargement en cours...</div>

<div *ngIf="!loading && bom" class="facture-wrapper">

  <h2 class="page-title">ğŸ§¾ Facturation de la nomenclature</h2>

  <div class="facture-header">
    <div class="facture-info">
      <p><strong>ğŸ‘¤ Client :</strong> {{ bom.client_name }}</p>
      <p><strong>ğŸ“ Dossier :</strong> {{ bom.dossier }}</p>
      <p><strong>ğŸ—“ï¸ Date :</strong> {{ bom.date_creation }}</p>
    </div>
  </div>

  <div class="facture-table-container">
    <table class="facture-table">
      <thead>
        <tr>
          <th>Code</th>
          <th>DÃ©signation</th>
          <th>QuantitÃ©</th>
          <th>Prix Navision</th>
          <th>Prix saisi</th>
          <th>Date de valorisation</th>
          <th>Total ligne</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ligne of lignesFacture">
          <td>{{ ligne.code }}</td>
          <td>{{ ligne.designation }}</td>
          <td>{{ ligne.quantite }}</td>
          <td>{{ ligne.prix_unitaire | number:'1.3-3' }} TND</td>
          <td>
            <input
              type="number"
              class="prix-input"
              [(ngModel)]="ligne.prix_personnalise"
              (input)="recalculerTotal()"
              placeholder="0.000"
            />
          </td>
          <td>{{ ligne.posting_date }}</td>
          <td>{{ ligne.total_ligne }} TND</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="facture-footer">
    <p class="total-global">
      <strong>Total global :</strong> {{ total.toFixed(2) }} TND
    </p>

    <button class="btn-pdf" (click)="genererFacturePDF()">
      ğŸ“¥ GÃ©nÃ©rer et tÃ©lÃ©charger la facture
    </button>
  </div>

</div>
