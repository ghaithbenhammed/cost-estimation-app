<div class="page-container mt-4">
  <h2 class="page-title">ğŸ“‹ Liste des demandes client</h2>

  <div class="filter-container">
    <label for="statusFilter" class="filter-label">Filtrer :</label>
    <select
      id="statusFilter"
      [(ngModel)]="selectedStatus"
      (change)="filterByStatus()"
      class="filter-select"
    >
      <option value="all">Toutes</option>
      <option value="pending">En attente</option>
      <option value="completed">TerminÃ©e</option>
      <option value="rejected">RejetÃ©e</option>
    </select>
  </div>

  <div class="card-container">
    <div *ngFor="let demande of filteredDemandes" class="card">
      <div class="card-body">
        <h5 class="card-title">
          {{ demande.customer_name || "Client inconnu" }} ({{
            demande.customer_no
          }})
          <span class="badge" [ngClass]="getBadgeClass(demande.status)">
            {{ getStatusLabel(demande.status) }}
          </span>
        </h5>

        <p><strong>Type :</strong> {{ demande.request_type }}</p>
        <p><strong>Puissance :</strong> {{ demande.power }}</p>
        <p>
          <strong>Tension :</strong> {{ demande.primary_voltage }} /
          {{ demande.secondary_voltage }}
        </p>
        <p><strong>FrÃ©quence :</strong> {{ demande.frequency }}</p>

        <div class="form-group mt-3">
          <label [for]="'statusSelect-' + demande.id" class="form-label"
            >Changer de statut :</label
          >
          <select
            [id]="'statusSelect-' + demande.id"
            [(ngModel)]="demande.status"
            (change)="updateStatus(demande)"
            class="form-select form-select-sm"
            title="Changer le statut de la demande"
          >
            <option value="pending">En attente</option>
            <option value="completed">TerminÃ©e</option>
            <option value="rejected">RejetÃ©e</option>
          </select>
        </div>

        <!-- Actions selon le statut -->
        <div class="action-buttons mt-3">
          <!-- En attente : tout est actif -->
          <ng-container *ngIf="demande.status === 'pending'">
            <button class="btn-view" (click)="voirNomenclature(demande)">
              ğŸ‘ï¸ Voir la nomenclature
            </button>
            <button class="btn-delete" (click)="supprimerDemande(demande)">
              ğŸ—‘ï¸ Supprimer
            </button>
          </ng-container>

          <!-- TerminÃ©e : vue possible -->
          <ng-container *ngIf="demande.status === 'completed'">
            <button class="btn-view" (click)="voirNomenclature(demande)">
              ğŸ‘ï¸ Voir la nomenclature
            </button>
            <button class="btn-delete" (click)="supprimerDemande(demande)">
              ğŸ—‘ï¸ Supprimer
            </button>
          </ng-container>

          <!-- RejetÃ©e : vue dÃ©sactivÃ©e -->
          <ng-container *ngIf="demande.status === 'rejected'">
            <button
              class="btn-view disabled-button"
              disabled
              title="La nomenclature est inaccessible pour une demande rejetÃ©e"
            >
              ğŸš« Voir la nomenclature
            </button>
            <button class="btn-delete" (click)="supprimerDemande(demande)">
              ğŸ—‘ï¸ Supprimer
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>
